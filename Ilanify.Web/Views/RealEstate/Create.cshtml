@using Ilanify.Domain.Entities
@model RealEstate

<h2>Yeni İlan Ekle</h2>

<form asp-action="Create" method="post" enctype="multipart/form-data">
    <div class="form-group">
        <label for="Title">Başlık</label>
        <input asp-for="Title" class="form-control"/>
    </div>
    <div class="form-group">
        <label for="Description">Açıklama</label>
        <textarea asp-for="Description" class="form-control"></textarea>
    </div>
    <div class="form-group">
        <label for="images">Resimler</label>
        <input type="file" name="images" class="form-control" multiple/>
    </div>
    <div class="form-group">
        <label for="Price">Fiyat</label>
        <input asp-for="Price" class="form-control"/>
    </div>
    <div class="form-group">
        <label for="SquareMeters">Metrekare</label>
        <input asp-for="SquareMeters" class="form-control"/>
    </div>
    <div class="form-group">
        <label for="Location">Lokasyon</label>
        <input asp-for="Location.Id" type="hidden"/>
        <input asp-for="Location.City" placeholder="Şehir" class="form-control"/>
        <input asp-for="Location.District" placeholder="İlçe" class="form-control"/>
        <input asp-for="Location.Neighboord" placeholder="Mahalle" class="form-control"/>
    </div>
    <div class="form-group">
        <label for="Category">Kategori</label>
        <select id="categorySelect" asp-for="CategoryId" asp-items="@ViewBag.Categories" class="form-control" onchange="loadCategoryAttributes()">
            <option value="">-- Seçiniz --</option>
        </select>
    </div>
    <div id="categoryAttributes"></div>
    <button type="submit" class="btn btn-primary">İlanı Ekle</button>
</form>

@section Scripts {
    <script>
       function loadCategoryAttributes() {
           const categoryId = $('#categorySelect').val();
           if (!categoryId) {
               $('#categoryAttributes').empty();
               return;
           }
       
           $.ajax({
               url: `/GetCategoryAttributes/${categoryId}`,
               success: function(data) {
                   let attributesHtml = '';
                   $.each(data, function(index, attr) {
                       attributesHtml += `<div class="form-group">`;
                       attributesHtml += `<label>${attr.name}</label>`;
                       attributesHtml += `<input type="hidden" name="attributeValues[${index}].AttributeId" value="${attr.id}" />`;
                       attributesHtml += `<input type="hidden" name="attributeValues[${index}].CategoryAttributeId" value="${attr.id}" />`;
                       attributesHtml += `<input type="text" name="attributeValues[${index}].Value" class="form-control" />`;
                       attributesHtml += `</div>`;
                   });
                   $('#categoryAttributes').html(attributesHtml);
               },
               error: function(xhr, status, error) {
                   console.error('Error loading category attributes:', error);
               }
           });
       }
    </script>
}